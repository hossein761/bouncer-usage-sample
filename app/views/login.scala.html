<html>
	<body>
		<head>
		<script src="@routes.Assets.at("javascripts/jquery.js")" type="text/javascript"></script>
		</head>
		<div>
			<form id="login-form">
				Username/Email: <input type="text" name="emailOrUserName"><br>
				Password	  :<input type="text" name="password"><br>
				<input type="submit" value="Login" id="login-button">
			</form>
	</div>
	
	<div>
		<a href="assets/signup.html">Register</a>
	</div>
	<script type="text/javascript">
	
	/*document.cookie.split('; ').forEach(function(cookieString){
		console.log(cookieString);
		var cookie = cookieString.split("=");
		if(cookie[0] === 'Access-Token' && cookie[1].length > 1){
			console.log(cookie[1]);
		}
	});*/
	
	console.log(getCookie('Access-Token'));
	
	function getCookie(name){
		var value = "; " + document.cookie;
		var parts = value.split("; "+ name + "=");
		if(parts.length == 2)
			return parts.pop.split(";").shift();
	}
	
	$("#login-form").submit(function(event){
		event.preventDefault();
		var $form = $(this);
		var emailOrUserName = $form.find("input[name='emailOrUserName']").val();
		console.log(emailOrUserName);
		var password = $form.find("input[name='password']").val();
		console.log(password);

		$.ajax({
			type: "POST",
			url: "/auth/login",
			data:{emailOrUserName:emailOrUserName, 
				  password:password},
			success:function(authCode){
				var atRequest = "/auth/accessToken?authCode="+authCode; 
				$.ajax({
					type: "GET",
					url: atRequest,
					dataType: "json",
					success: function(response, status, xhr){
						console.log(response);
						var accessToken = xhr.getResponseHeader('X-ACCESS-TOKEN');
						if(accessToken){
							window.location = '/';
						}
						
					},
					error: function(response){
						
					}
				});
			},
			error: function(response){
				console.log(response);
				
			}
		});
		
	});
	</script>
	
	</body>
</html>
	
